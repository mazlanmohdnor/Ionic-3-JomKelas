{"version":3,"sources":["../../src/pages/verifymail/verifymail.module.ts","../../src/pages/verifymail/verifymail.ts"],"names":[],"mappings":"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","file":"9.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { VerifymailPage } from './verifymail';\n\n@NgModule({\n  declarations: [\n    VerifymailPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(VerifymailPage),\n  ],\n})\nexport class VerifymailPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/verifymail/verifymail.module.ts","import { AngularFireDatabase } from 'angularfire2/database';\nimport { AngularFireAuth } from \"angularfire2/auth\";\nimport { InAppBrowser } from \"@ionic-native/in-app-browser\";\nimport { Component } from \"@angular/core\";\nimport {\n  IonicPage,\n  NavController,\n  NavParams,\n  AlertController,\n  LoadingController,\n  Events\n} from \"ionic-angular\";\n\n@IonicPage()\n@Component({\n  selector: \"page-verifymail\",\n  templateUrl: \"verifymail.html\"\n})\nexport class VerifymailPage {\n  matric: any;\n  phone: string;\n  photoURL: string;\n  email: string;\n  displayName: string;\n  constructor(\n    public navCtrl: NavController,\n    public navParams: NavParams,\n    public iab: InAppBrowser,\n    public firebase: AngularFireAuth,\n    public alertCtrl: AlertController,\n    public loadingCtrl: LoadingController,\n    public firebaseDB: AngularFireDatabase,\n    public event: Events\n    \n  ) {\n    this.matric = this.firebase.auth.currentUser.email;\n  }\n\n  // navigate to upm email login page\n  navigateEmail() {\n    let browser = open(\n      \"http://mail.student.upm.edu.my/\",\n      \"_self\",\n      \"location=true\"\n    );\n    let loader = this.loadingCtrl.create({\n      content: \"Validating...\"\n    });\n    browser.addEventListener(\"exit\", () => {\n      loader.present();\n      this.firebase.auth.onAuthStateChanged(user => {\n        //if user x logged in, set page ke login\n        user.reload().then(() => {\n          if (this.firebase.auth.currentUser.emailVerified) {\n            //email verified, send user to homepage\n             //update side menu\n             this.firebaseDB.database\n             .ref(`userProfile/${user.uid}`)\n             .once(\"value\", result => {\n               this.event.publish(\"user:loggedIn\", result.val());\n             });\n            this.navCtrl.setRoot(\"HomePage\").then(() => loader.dismiss());\n          } else {\n            this.navCtrl.setRoot(\"VerifymailPage\").then(() => loader.dismiss());\n          }\n        });\n      });\n    });\n  }\n\n  //resend verification email\n  resendEmail() {\n    let loader = this.loadingCtrl.create({\n      content: \"Re-sending Email...\"\n    });\n    loader.present();\n    var email = this.matric;\n    this.firebase.auth.currentUser.sendEmailVerification().then(\n      () => {\n        //success\n        let alert = this.alertCtrl.create({\n          title: \"Email sent\",\n          subTitle: \"Please check your email at \" + email,\n          buttons: [\n            {\n              text: \"OK\",\n              role: \"cancel\",\n              handler: () => {\n                console.log(\"Cancel clicked\");\n              }\n            },\n            {\n              text: \"Check Email\",\n              handler: () => {\n                this.navigateEmail();\n              }\n            }\n          ]\n        });\n        loader.dismiss();\n        alert.present();\n      },\n      error => {\n        loader.dismiss();\n        let alert = this.alertCtrl.create({\n          title: \"Try again\",\n          subTitle: error.message,\n          buttons: [\"OK\"]\n        });\n        alert.present();\n      }\n    );\n  }\n\n  home() {\n    this.navCtrl.setRoot(\"HomePage\").then(_=>{\n      this.firebaseDB.database\n      .ref(`userProfile/${this.firebase.auth.currentUser.uid}`)\n      .once(\"value\", result => {\n      this.event.publish(\"user:loggedIn\", result.val());\n      })\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/verifymail/verifymail.ts"],"sourceRoot":""}